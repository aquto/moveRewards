/*! move-rewards 2020-03-31 */

!function(e,n){var i={body:n.body,video:J("video"),eligibleElement:J("eligibleWrapper"),errorElement:J("errorWrapper"),ineligibleMsgElement:J("ineligibleMessage"),icon:J("icon"),phoneEntry:J("phoneEntryWrapper"),eligibleUI:J("eligible"),ineligibleUI:J("ineligible"),timer:J("timer"),phoneCheck:J("phoneCheck"),input:n.querySelector("#phone"),videoTimer:J("videoTimer"),currentTimeTxt:J("currentTime"),durationTxt:J("duration"),loadingWrapper:J("loadingWrapper"),loading:J("loading"),phoneEntryTitle:J("phoneEntryTitle"),thanksMsg:J("thanksMsg"),processingText:J("processingText"),phoneEntrySubTitle:J("phoneEntrySubTitle"),phoneEntrySubmitBtn:J("phoneEntrySubmitBtn"),rewardTextEligible:J("rewardTextEligible"),continueBtn:J("continueBtn"),eligibleBtn:J("eligibleBtn"),ineligibleTitle:J("ineligibleTitle"),ineligibleSubTitle:J("ineligibleSubTitle"),ineligibleBtn:J("ineligibleBtn"),errorMsg:J("errorMsg")};let t=J("videoOverlay"),o=J("loadingOverlay");const l=z("cid"),r=z("vu"),c="1"===z("d"),a=z("b"),s="1"===z("dc"),u=z("psid"),d=z("ch"),p=z("co")&&z("co").split(","),g=z("l")&&z("l").split(","),m=[0,25,50,75,95],b={impression:z("trimp"),click:z("trclk"),video:{start:z("trvst"),25:z("trv25"),50:z("trv50"),75:z("trv75"),95:z("trv95"),complete:z("trvc")}},h="-",v={impression:"impression",autoIdentify:"click",phoneEntry:"phonenumber",videoStart:"videostart",videoEnd:"videoend",videoError:"videoerror"},f=parseScriptQuery(document.getElementById("aquto-api")),y=f.be||"app.aquto.com",T=(f.ow,{mx:{minLen:12,maxLen:12,countryCode:"52"},cl:{minLen:11,maxLen:11,countryCode:"56"},ar:{minLen:10,maxLen:14,countryCode:"549"},co:{minLen:12,maxLen:12,countryCode:"57"},pe:{minLen:11,maxLen:11,countryCode:"51"},br:{minLen:13,maxLen:13,countryCode:"55"}}),E={52:"mx",56:"cl",549:"ar",57:"co",51:"pe",55:"br"},L=["mx","cl","ar","co","pe","br"],k=L,M=intersect(p,L)||k,x=M[0],C=["es","pt","en"],w=C,I=intersect(g,C)||w,S=(navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.userLanguage||navigator.language||navigator.browserLanguage||w[0]).substring(0,2),B=I.find(function(e){return S===e})||I[0],U=translations[B];let H,W,P=!1,D=!1,N=!1;const q=videojs("player",{controls:!s,autoplay:!1,preload:!0,nativeControlsForTouch:!1,inactivityTimeout:0,disableVideoPlayPauseClick:!0,poster:a||"../assets/images/watch-this-eligible.png",sources:[{type:"video/mp4",src:"../assets/videos/placeholder.mp4"}],plugins:{vastClient:{adTagUrl:r,preferredTech:"html5",adsEnabled:!0}}});q.on("play",function(){G("play"),D&&X(i.video),s&&(i.currentTimeTxt.innerHTML=$(Math.floor(this.currentTime()))),P||(P=!0,ee(),ee(b.video.start))}),q.on("timeupdate",function(e){if(!D){const e=Math.floor(this.currentTime()/this.duration()*100);if(G("update",e),n=this.currentTime(),t=this.duration(),s&&(i.currentTimeTxt.innerHTML=$(Math.floor(n)),i.durationTxt.innerHTML=$(Math.floor(t))),W.clickId){const n=m;let i=null;do{e>=(i=n.length>0?n[0]:101)&&(n.shift(),te(W.clickId,i),te(null,null,b.video[i]))}while(e>=i)}}var n,t}),q.on("vast.adError",function(e){X(i.ineligibleMsgElement),G("vast.adError",e.error),X(i.eligibleElement),X(i.video),K(i.errorElement),D=!0}),q.on("vast.contentEnd",function(){var e;G("vast.contentEnd"),X(i.video),D?e?oe(null,null,"custom video end url",e):ie(v.impression):(ne(),ne(b.video.complete),N?(K(i.eligibleElement),aquto.complete({campaignId:l,callback:function(e){G("complete"),e?(X(i.loadingWrapper),K(i.eligibleElement),i.icon.classList.remove("fa-check-circle","fa-times-circle"),e.eligible?(G("complete success"),i.icon.classList.add("fa-check-circle"),Z("success"),i.processingText.innerHTML=e.rewardText):(G("complete failure"),i.icon.classList.toggle("fa-times-circle"),Z("fail"),i.processingText.innerHTML=U.ineligibleMsg)):(G("complete invalid response"),i.icon.classList.toggle("fa-times-circle"),Z("fail"),i.processingText.innerHTML=U.completeFailMsg)}})):(G("not eligible"),X(i.video),K(i.ineligibleMsgElement)))}),c&&(q.on("click",function(e){G("click",e)}),q.on("vast.adClick",function(e){G("vast.adClick",e)}));const O={allowDropdown:!0,formatOnDisplay:!0,initialCountry:x,nationalMode:!1,onlyCountries:M,separateDialCode:!0},R=e.intlTelInput(i.input,O);let j=5;const A=function(){event&&event.preventDefault();const e=R.getNumber().replace("+","");K(o),o.addEventListener("click",function(e){e.stopPropagation&&e.stopPropagation(),null!==e.cancelBubble&&(e.cancelBubble=!0)});const n=re(d,e?v.phoneEntry:v.autoIdentify);G("checkPhoneNumber",{phone:e,publisherSiteUuid:u,callChannel:n}),aquto.checkAppEligibility({campaignId:l,phoneNumber:e,publisherSiteUuid:u,channel:n,callback:function(n){G("checkAppEligibilityResponse",n),X(o),n?(X(t),s&&K(i.videoTimer),W=Object.assign({},n),n.identified?(n.eligible?(N=!0,e?(G("phone entered eligible"),j=5,K(i.eligibleUI),X(i.phoneCheck),i.rewardTextEligible.innerHTML=n.rewardText):(G("identified & eligible"),X(i.loadingWrapper),K(i.video),q.play())):(N=!1,e?(G("phone entered ineligible"),j=5,K(i.ineligibleUI),X(i.phoneCheck)):(G("identified + ineligible"),j=10,X(i.loadingWrapper),X(i.video),K(i.phoneEntry),X(i.phoneCheck),K(i.ineligibleUI),K(i.timer),i.timer.innerHTML=le(j),Y(),oe(null,null,"custom banner click url",b.click))),e&&(K(i.timer),i.timer.innerHTML=le(j),Y())):e?(G("phone entered unidentified"),j=10,N=!1,K(i.ineligibleUI),X(i.phoneCheck),K(i.timer),i.timer.innerHTML=le(j),Y()):(G("unidentified"),N=!1,X(i.loadingWrapper),X(i.video),K(i.phoneEntry))):(G("error.checkAppEligibility"),X(i.loadingWrapper),X(i.video),K(i.errorElement))}})},F=function(e){event&&event.preventDefault(),H&&(clearTimeout(H),H=null,G("countdown stopped")),X(i.phoneEntry),X(i.eligibleElement),K(i.video),0!==e&&q.play()},V=function(){const e=i.timer;j>0?(j--,e.innerHTML=le(j),Y()):F(!0)};function Q(){const e=R.getNumber().replace("+",""),n=function(){const e=R.getNumber().replace("+",""),n=Object.entries(E);for(let i=0;i<n.length;i++)if(e.substring(0,n[i][0].length)===n[i][0])return n[i][1]}(),t=n&&e.length>=T[n].minLen&&e.length<=T[n].maxLen;i.phoneEntrySubmitBtn.disabled=!t}function z(n){let i,t,o=e.location.search.substring(1).split("&");for(t=0;t<o.length;t++)if((i=o[t].split("="))[0]===n)return void 0===i[1]||decodeURIComponent(i[1])}function G(e,n){c&&console.log(e,n)}function J(e){return n.getElementById(e)}function K(e){e&&e.classList.remove("hide")}function X(e){e&&e.classList.add("hide")}function Y(){H=setTimeout("countDown()",1e3)}function Z(e){"success"===e&&(i.body.classList.remove("fail"),i.body.classList.add(e)),"fail"===e&&(i.body.classList.remove("success"),i.body.classList.add(e))}function $(e){return Math.floor(e/60).toString().padStart(2,"0")+":"+(e%60).toString().padStart(2,"0")}function _(e){e?oe(null,null,"custom impression url",e):ie(v.impression)}function ee(e){e?oe(null,null,"custom video start url",e):ie(v.impression)}function ne(e){e?oe(null,null,"custom video end url",e):ie(v.impression)}function ie(e){oe("datarewards/pixel","?campaignId="+encodeURIComponent(l)+"&publisherSiteUuid="+encodeURIComponent(ce(u))+"&channel="+encodeURIComponent(re(d,e)),"tracking url")}function te(e,n,i){if(e){oe("event/videoview","?clickId="+ce(e)+"&percentageViewed="+n,"video tracking url")}i&&oe(null,null,"custom video tracking url",i)}function oe(e,n,i,t){var o="";e&&n&&(o="//"+y+"/api/campaign/"+e+n),t&&(o=t),G(i,o),(new Image).src=o}function le(e){return U.timer.replace(/\{count\}/,e)}function re(e,n){const i=e?h:"";return ce(e)+i+ce(n)}function ce(e){return void 0===e||null===e?"":e}!function(){t.addEventListener("click",function(e){e.stopPropagation&&e.stopPropagation(),null!==e.cancelBubble&&(e.cancelBubble=!0),X(video),A()}),F(0),function(){const e=[i.loading,i.phoneEntryTitle,i.thanksMsg,i.processingText,i.phoneEntrySubTitle,i.phoneEntrySubmitBtn,i.rewardTextEligible,i.continueBtn,i.eligibleBtn,i.ineligibleTitle,i.ineligibleSubTitle,i.ineligibleBtn,i.errorMsg,i.timer];for(let n=0;n<e.length;n++)"string"==typeof e[n].id&&(e[n].innerHTML=U[e[n].id].replace(/\n/,"<br/>"))}(),i.input.maxLength=18,i.input.onkeydown=function(){Q()},i.input.onkeyup=function(){Q()},i.input.addEventListener("countrychange",function(){Q(),i.input.value=""}),i.input.onkeypress=function(e){let n=e.which?e.which:e.keyCode;return!(n>31&&(n<48||n>57))},X(i.loadingWrapper),_(),_(b.impression),this.checkPhoneNumber=A,this.showPlayer=F,this.countDown=V}()}(window,document);