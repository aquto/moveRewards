/*! move-rewards 2020-03-05 */

!function(e,n){var i={body:n.body,video:G("video"),eligibleElement:G("eligibleWrapper"),errorElement:G("errorWrapper"),ineligibleMsgElement:G("ineligibleMessage"),icon:G("icon"),phoneEntry:G("phoneEntryWrapper"),eligibleUI:G("eligible"),ineligibleUI:G("ineligible"),timer:G("timer"),phoneCheck:G("phoneCheck"),input:n.querySelector("#phone"),videoTimer:G("videoTimer"),currentTimeTxt:G("currentTime"),durationTxt:G("duration"),loadingWrapper:G("loadingWrapper"),loading:G("loading"),phoneEntryTitle:G("phoneEntryTitle"),thanksMsg:G("thanksMsg"),processingText:G("processingText"),phoneEntrySubTitle:G("phoneEntrySubTitle"),phoneEntrySubmitBtn:G("phoneEntrySubmitBtn"),rewardTextEligible:G("rewardTextEligible"),continueBtn:G("continueBtn"),eligibleBtn:G("eligibleBtn"),ineligibleTitle:G("ineligibleTitle"),ineligibleSubTitle:G("ineligibleSubTitle"),ineligibleBtn:G("ineligibleBtn"),errorMsg:G("errorMsg")};let t=G("videoOverlay"),o=G("loadingOverlay");const r=Q("cid"),l=Q("vu"),c="1"===Q("d"),a=Q("b"),s="1"===Q("dc"),d=Q("psid"),u=Q("ch"),p=Q("co")&&Q("co").split(","),g=Q("l")&&Q("l").split(","),m=[0,25,50,75,95],b="-",h={impression:"impression",autoIdentify:"click",phoneEntry:"phonenumber",videoStart:"videostart",videoEnd:"videoend",videoError:"videoerror"},f=parseScriptQuery(document.getElementById("aquto-api")),v=f.be||"app.aquto.com",y=(f.ow,{mx:{minLen:12,maxLen:12,countryCode:"52"},cl:{minLen:11,maxLen:11,countryCode:"56"},ar:{minLen:10,maxLen:14,countryCode:"549"},co:{minLen:12,maxLen:12,countryCode:"57"},pe:{minLen:11,maxLen:11,countryCode:"51"},br:{minLen:13,maxLen:13,countryCode:"55"}}),T={52:"mx",56:"cl",549:"ar",57:"co",51:"pe",55:"br"},E=["mx","cl","ar","co","pe","br"],L=E,k=intersect(p,E)||L,M=k[0],x=["es","pt","en"],C=x,w=intersect(g,x)||C,I=(navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.userLanguage||navigator.language||navigator.browserLanguage||C[0]).substring(0,2),S=w.find(function(e){return I===e})||w[0],B=translations[S];let U,H,W=!1,P=!1,D=!1;const N=videojs("player",{controls:!s,autoplay:!1,preload:!0,nativeControlsForTouch:!1,inactivityTimeout:0,disableVideoPlayPauseClick:!0,poster:a||"../assets/images/watch-this-eligible.png",sources:[{type:"video/mp4",src:"../assets/videos/placeholder.mp4"}],plugins:{vastClient:{adTagUrl:l,preferredTech:"html5",adsEnabled:!0}}});N.on("play",function(){z("play"),P&&K(i.video),s&&(i.currentTimeTxt.innerHTML=Z(Math.floor(this.currentTime()))),W||(W=!0,$(h.videoStart))}),N.on("timeupdate",function(e){if(!P){const e=Math.floor(this.currentTime()/this.duration()*100);if(z("update",e),n=this.currentTime(),t=this.duration(),s&&(i.currentTimeTxt.innerHTML=Z(Math.floor(n)),i.durationTxt.innerHTML=Z(Math.floor(t))),H.clickId){const n=m;let i=null;do{e>=(i=n.length>0?n[0]:101)&&(n.shift(),_(H.clickId,i))}while(e>=i)}}var n,t}),N.on("vast.adError",function(e){K(i.ineligibleMsgElement),z("vast.adError",e.error),K(i.eligibleElement),K(i.video),J(i.errorElement),P=!0}),N.on("vast.contentEnd",function(){z("vast.contentEnd"),K(i.video),P?$(h.videoError):($(h.videoEnd),D?(J(i.eligibleElement),aquto.complete({campaignId:r,callback:function(e){z("complete"),e?(K(i.loadingWrapper),J(i.eligibleElement),i.icon.classList.remove("fa-check-circle","fa-times-circle"),e.eligible?(z("complete success"),i.icon.classList.add("fa-check-circle"),Y("success"),i.processingText.innerHTML=e.rewardText):(z("complete failure"),i.icon.classList.toggle("fa-times-circle"),Y("fail"),i.processingText.innerHTML=B.ineligibleMsg)):(z("complete invalid response"),i.icon.classList.toggle("fa-times-circle"),Y("fail"),i.processingText.innerHTML=B.completeFailMsg)}})):(z("not eligible"),K(i.video),J(i.ineligibleMsgElement)))}),c&&(N.on("click",function(e){z("click",e)}),N.on("vast.adClick",function(e){z("vast.adClick",e)}));const q={allowDropdown:!0,formatOnDisplay:!0,initialCountry:M,nationalMode:!1,onlyCountries:k,separateDialCode:!0},O=e.intlTelInput(i.input,q);let R=5;const j=function(){event&&event.preventDefault();const e=O.getNumber().replace("+","");J(o),o.addEventListener("click",function(e){e.stopPropagation&&e.stopPropagation(),null!==e.cancelBubble&&(e.cancelBubble=!0)});const n=ie(u,e?h.phoneEntry:h.autoIdentify);z("checkPhoneNumber",{phone:e,publisherSiteUuid:d,callChannel:n}),aquto.checkAppEligibility({campaignId:r,phoneNumber:e,publisherSiteUuid:d,channel:n,callback:function(n){z("checkAppEligibilityResponse",n),K(o),n?(K(t),s&&J(i.videoTimer),H=Object.assign({},n),n.identified?(n.eligible?(D=!0,e?(z("phone entered eligible"),R=5,J(i.eligibleUI),K(i.phoneCheck),i.rewardTextEligible.innerHTML=n.rewardText):(z("identified & eligible"),K(i.loadingWrapper),J(i.video),N.play())):(D=!1,e?(z("phone entered ineligible"),R=5,J(i.ineligibleUI),K(i.phoneCheck)):(z("identified + ineligible"),R=10,K(i.loadingWrapper),K(i.video),J(i.phoneEntry),K(i.phoneCheck),J(i.ineligibleUI),J(i.timer),i.timer.innerHTML=ne(R),X())),e&&(J(i.timer),i.timer.innerHTML=ne(R),X())):e?(z("phone entered unidentified"),R=10,D=!1,J(i.ineligibleUI),K(i.phoneCheck),J(i.timer),i.timer.innerHTML=ne(R),X()):(z("unidentified"),D=!1,K(i.loadingWrapper),K(i.video),J(i.phoneEntry))):(z("error.checkAppEligibility"),K(i.loadingWrapper),K(i.video),J(i.errorElement))}})},A=function(e){event&&event.preventDefault(),U&&(clearTimeout(U),U=null,z("countdown stopped")),K(i.phoneEntry),K(i.eligibleElement),J(i.video),0!==e&&N.play()},F=function(){const e=i.timer;R>0?(R--,e.innerHTML=ne(R),X()):A(!0)};function V(){const e=O.getNumber().replace("+",""),n=function(){const e=O.getNumber().replace("+",""),n=Object.entries(T);for(let i=0;i<n.length;i++)if(e.substring(0,n[i][0].length)===n[i][0])return n[i][1]}(),t=n&&e.length>=y[n].minLen&&e.length<=y[n].maxLen;i.phoneEntrySubmitBtn.disabled=!t}function Q(n){let i,t,o=e.location.search.substring(1).split("&");for(t=0;t<o.length;t++)if((i=o[t].split("="))[0]===n)return void 0===i[1]||decodeURIComponent(i[1])}function z(e,n){c&&console.log(e,n)}function G(e){return n.getElementById(e)}function J(e){e&&e.classList.remove("hide")}function K(e){e&&e.classList.add("hide")}function X(){U=setTimeout("countDown()",1e3)}function Y(e){"success"===e&&(i.body.classList.remove("fail"),i.body.classList.add(e)),"fail"===e&&(i.body.classList.remove("success"),i.body.classList.add(e))}function Z(e){return Math.floor(e/60).toString().padStart(2,"0")+":"+(e%60).toString().padStart(2,"0")}function $(e){ee("datarewards/pixel","?campaignId="+encodeURIComponent(r)+"&publisherSiteUuid="+encodeURIComponent(te(d))+"&channel="+encodeURIComponent(ie(u,e)),"tracking url")}function _(e,n){ee("event/videoview","?clickId="+te(e)+"&percentageViewed="+n,"video tracking url")}function ee(e,n,i){const t="//"+v+"/api/campaign/"+e+n;z(i,t),(new Image).src=t}function ne(e){return B.timer.replace(/\{count\}/,e)}function ie(e,n){const i=e?b:"";return te(e)+i+te(n)}function te(e){return void 0===e||null===e?"":e}!function(){t.addEventListener("click",function(e){e.stopPropagation&&e.stopPropagation(),null!==e.cancelBubble&&(e.cancelBubble=!0),K(video),j()}),A(0),function(){const e=[i.loading,i.phoneEntryTitle,i.thanksMsg,i.processingText,i.phoneEntrySubTitle,i.phoneEntrySubmitBtn,i.rewardTextEligible,i.continueBtn,i.eligibleBtn,i.ineligibleTitle,i.ineligibleSubTitle,i.ineligibleBtn,i.errorMsg,i.timer];for(let n=0;n<e.length;n++)"string"==typeof e[n].id&&(e[n].innerHTML=B[e[n].id])}(),i.input.maxLength=18,i.input.onkeydown=function(){V()},i.input.onkeyup=function(){V()},i.input.addEventListener("countrychange",function(){V(),i.input.value=""}),i.input.onkeypress=function(e){let n=e.which?e.which:e.keyCode;return!(n>31&&(n<48||n>57))},K(i.loadingWrapper),$(h.impression),this.checkPhoneNumber=j,this.showPlayer=A,this.countDown=F}()}(window,document);