/*! move-rewards 2020-02-21 */

!function(e,i){var n={loading:w("preload"),video:w("video"),eligibleElement:w("eligibleWrapper"),errorElement:w("errorWrapper"),ineligibleMsgElement:w("ineligibleMessage"),body:i.body,icon:w("icon"),text:w("rewardText"),phoneEntry:w("phoneEntryWrapper"),eligibleUI:w("eligible"),ineligibleUI:w("ineligible"),timer:w("timer"),rewardTextEligible:w("rewardTextEligible"),phoneCheck:w("phoneCheck"),input:i.querySelector("#phone"),videoTimer:w("videoTimer"),currentTimeTxt:w("currentTime"),durationTxt:w("duration")};let t=w("videoOverlay"),o=w("loadingOverlay");const l=k("cid"),r=k("vu"),a="1"===k("d"),c=k("b"),s="1"===k("dc"),d=[0,25,50,75,95],p=parseScriptQuery(document.getElementById("aquto-api")),u=p.be||"app.aquto.com";p.ow;let g,m,b=!1,h=!1;const f=videojs("player",{controls:!s,autoplay:!1,preload:!0,nativeControlsForTouch:!1,inactivityTimeout:0,disableVideoPlayPauseClick:!0,poster:c||"../assets/images/watch-this-eligible.png",sources:[{type:"video/mp4",src:"../assets/videos/placeholder.mp4"}],plugins:{vastClient:{adTagUrl:r,preferredTech:"html5",adsEnabled:!0}}});f.on("play",function(){L("play"),b&&x(n.video),s&&(n.currentTimeTxt.innerHTML=H(Math.floor(this.currentTime())))}),f.on("timeupdate",function(e){if(!b){const e=Math.floor(this.currentTime()/this.duration()*100);if(L("update",e),i=this.currentTime(),t=this.duration(),s&&(n.currentTimeTxt.innerHTML=H(Math.floor(i)),n.durationTxt.innerHTML=H(Math.floor(t))),m.clickId){const i=d;let n=null;do{e>=(n=i.length>0?i[0]:101)&&(i.shift(),P(m.clickId,n))}while(e>=n)}}var i,t}),a&&(f.on("click",function(e){L("click",e)}),f.on("vast.adClick",function(e){L("vast.adClick",e)})),f.on("vast.adError",function(e){x(n.ineligibleMsgElement),L("vast.adError",e.error),x(n.eligibleElement),x(n.video),M(n.errorElement),b=!0}),f.on("vast.contentEnd",function(){L("vast.contentEnd"),x(n.video),!b&&h&&(M(n.eligibleElement),aquto.complete({campaignId:l,callback:function(e){L("complete"),e?(x(n.loading),M(n.eligibleElement),n.icon.classList.remove("fa-check-circle","fa-times-circle"),e.eligible?(L("complete success"),n.icon.classList.add("fa-check-circle"),C("success"),n.text.innerHTML=e.rewardText):(L("complete failure"),n.icon.classList.toggle("fa-times-circle"),C("fail"),n.text.innerHTML="Lo sentimos, tu número no aplica para ganar megas en éste momento")):(L("complete invalid response"),n.icon.classList.toggle("fa-times-circle"),C("fail"),n.text.innerHTML="Lo sentimos, hubo un problema para activar los megas.")}})),h||b||(L("not eligible"),x(n.video),M(n.ineligibleMsgElement))});const v=e.intlTelInput(n.input,{allowDropdown:!0,formatOnDisplay:!0,initialCountry:"mx",nationalMode:!1,onlyCountries:["mx","pe"],separateDialCode:!0});let T=5;const y=function(){event&&event.preventDefault();const e=v.getNumber().replace("+","");M(o),o.addEventListener("click",function(e){e.stopPropagation&&e.stopPropagation(),null!==e.cancelBubble&&(e.cancelBubble=!0)}),aquto.checkAppEligibility({campaignId:l,phoneNumber:e,callback:function(i){L("checkAppEligibility"),x(o),i?(x(t),s&&M(n.videoTimer),m=Object.assign({},i),i.identified?(i.eligible?(h=!0,e?(L("phone entered eligible"),T=5,M(n.eligibleUI),x(n.phoneCheck),n.rewardTextEligible.innerHTML=i.rewardText):(L("identified & eligible"),x(n.loading),M(n.video),f.play())):(h=!1,e?(L("phone entered ineligible"),T=5,M(n.ineligibleUI),x(n.phoneCheck)):(L("identified + ineligible"),T=10,x(n.loading),x(n.video),M(n.phoneEntry),x(n.phoneCheck),M(n.ineligibleUI),M(n.timer),I())),e&&(n.timer.classList.remove("hide"),I())):e?(L("phone entered unidentified"),T=10,h=!1,M(n.ineligibleUI),x(n.phoneCheck),M(n.timer),I()):(L("unidentified"),h=!1,x(n.loading),x(n.video),M(n.phoneEntry))):(L("error.checkAppEligibility"),x(n.loading),x(n.video),M(n.errorElement))}})};const E=function(e){event&&event.preventDefault(),g&&(clearTimeout(g),g=null,L("countdown stopped")),x(n.phoneEntry),x(n.eligibleElement),M(n.video),0!==e&&f.play()};function k(i){let n,t,o=e.location.search.substring(1).split("&");for(t=0;t<o.length;t++)if((n=o[t].split("="))[0]===i)return void 0===n[1]||decodeURIComponent(n[1])}function L(e,i){a&&console.log(e,i)}function w(e){return i.getElementById(e)}function M(e){e&&e.classList.remove("hide")}function x(e){e&&e.classList.add("hide")}function I(){g=setTimeout("countDown()",1e3)}function C(e){"success"===e&&(n.body.classList.remove("fail"),n.body.classList.add(e)),"fail"===e&&(n.body.classList.remove("success"),n.body.classList.add(e))}function H(e){return Math.floor(e/60).toString().padStart(2,"0")+":"+(e%60).toString().padStart(2,"0")}function P(e,i){const n="//"+u+"/api/campaign/event/videoview"+("?clickId="+e+"&percentageViewed="+i);L("tracking",n),(new Image).src=n}window.onload=function(){x(n.loading),t.addEventListener("click",function(e){e.stopPropagation&&e.stopPropagation(),null!==e.cancelBubble&&(e.cancelBubble=!0),x(n.video),y()}),E(0)},this.checkPhoneNumber=y,this.showPlayer=E,this.countDown=function(){T>0?(T--,n.timer.innerHTML="Ver el video en "+T+" segundos.",I()):E(!0)}}(window,document);